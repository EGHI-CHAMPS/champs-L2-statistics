<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deep dive into a calc function • champs</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Deep dive into a calc function">
<meta property="og:description" content="champs">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">champs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data_intro.html">CHAMPS Introduction</a>
    </li>
    <li>
      <a href="../articles/download.html">Downloading CHAMPS data</a>
    </li>
    <li>
      <a href="../articles/data_load.html">Loading CHAMPS data and understanding its structure</a>
    </li>
    <li>
      <a href="../articles/usage.html">Computing summaries</a>
    </li>
    <li>
      <a href="../articles/plots_tables.html">Plots and tables</a>
    </li>
    <li>
      <a href="../articles/calc_deepdive.html">Deep dive into a calc function</a>
    </li>
    <li>
      <a href="../articles/custom_analyses_h_influenzae.html">Deep dive custom analysis</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/EGHI-CHAMPS/champs-L2-statistics/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Deep dive into a calc function</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EGHI-CHAMPS/champs-L2-statistics/blob/master/vignettes/calc_deepdive.Rmd"><code>vignettes/calc_deepdive.Rmd</code></a></small>
      <div class="hidden name"><code>calc_deepdive.Rmd</code></div>

    </div>

    
    
<p>In this article we illustrate in detail how to compute a common set of statistics of interest with CHAMPS data. This will help newcomers to CHAMPS data with understanding the nuances of the different tables and how they can be used together to answer questions of interest.</p>
<p>We will illustrate a computation that is provided by the <code><a href="../reference/calc_cc_detected_by_site_age.html">calc_cc_detected_by_site_age()</a></code>, where we look at in how many cases was death due to a given condition (etiology) in DeCoDe vs. how many cases a given pathogen was detected in TAC results, broken down by site and age. This requires merging information from the demographics, DeCoDe, and TAC tables.</p>
<p>Before diving into the data, we assume that you have read the <a href="data_intro.html">CHAMPS introduction</a> and <a href="data_load.html">data</a> articles.</p>
<p>In this example, we will be looking at in how many cases Group B Streptococcus was detected as a pathogen in the TAC results vs. how many cases were determined by DeCoDe for which Group B Streptococcus was in the causal chain.</p>
<p>For a quick refresh on the distinction between TAC and DeCoDe:</p>
<p>In TAC results, we are looking for detection of a <em>pathogen</em> in one or more <em>specimen types</em>. A pathogen is present if its result is “Positive”.</p>
<p>In DeCoDe, we are looking for detection of the <em>condition</em> that was in the <em>causal chain</em> of the cause of death. This is either provided as a <em>CHAMPS group description</em> or an <em>etiology</em>.</p>
<p>The distinction between counting things in DeCoDe vs. TAC can be thought as comparing dying <em>from</em> a condition vs. dying <em>with</em> a pathogen.</p>
<p>To begin our calculation, we load the package and the de-identified data, which here we have downloaded to a location <code>~/Downloads/CHAMPS_de_identified_data</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/EGHI-CHAMPS/champs-L2-statistics">champs</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://stringr.tidyverse.org">stringr</a></span>)
<span class="kw">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_data.html">load_data</a></span>(<span class="st">"~/Downloads/CHAMPS_de_identified_data"</span>)
</pre></div>
<p>We want to specify the condition and pathogen associated with Group B Streptococcus. Note that conditions and pathogens can overlap but may not always be expressed in the same way. You can call <code><a href="../reference/valid_conditions.html">valid_conditions(d)</a></code> to get a list of all conditions for which data exists (all unique values of etiologies or CHAMPS group descriptions), and you can call <code><a href="../reference/valid_pathogens.html">valid_pathogens()</a></code> for a list of all valid pathogen values as detected by TAC.</p>
<p>Searching the results of these <code>valid_</code> functions, we see that the condition we are looking for is not coded as “Group B Streptococcus”, but as “Streptococcus agalactiae”. The pathogen we are looking for, on the other hand, is simply “Group B Streptococcus”.</p>
<p>To start, let’s look at the TAC results to find cases where there is a positive result for “Group B Streptococcus”. We can either use the <code>tac_long</code> table or the <code>tac</code> table. Recall that the <code>tac</code> table looks like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">d</span><span class="op">$</span><span class="kw">tac</span>
<span class="co">#&gt; # A tibble: 1,473 x 325</span>
<span class="co">#&gt;    champs_deid bld_abau_1 bld_adev_1 bld_bart_1 bld_bruc_1 bld_bups_1 bld_caal_1</span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     </span>
<span class="co">#&gt;  1 AB032461-9… Negative   Negative   Negative   Negative   Negative   Negative  </span>
<span class="co">#&gt;  2 46B7C6E7-2… Negative   Negative   Negative   Negative   Negative   Negative  </span>
<span class="co">#&gt;  3 3791BBA8-4… Negative   Negative   Negative   Negative   Negative   Positive  </span>
<span class="co">#&gt;  4 52662D06-B… &lt;NA&gt;       Negative   &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;      </span>
<span class="co">#&gt;  5 7C1C58CB-3… &lt;NA&gt;       Negative   &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;      </span>
<span class="co">#&gt;  6 3D6C22BB-D… Negative   Negative   Negative   Negative   Negative   Negative  </span>
<span class="co">#&gt;  7 05B7F6AD-7… Negative   Negative   Negative   Negative   Negative   Negative  </span>
<span class="co">#&gt;  8 4A520B0F-4… &lt;NA&gt;       Negative   &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;      </span>
<span class="co">#&gt;  9 C8F59F60-1… Negative   Negative   Negative   Negative   Negative   Negative  </span>
<span class="co">#&gt; 10 D2406FD8-D… &lt;NA&gt;       Negative   &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;      </span>
<span class="co">#&gt; # … with 1,463 more rows, and 318 more variables: bld_cchf_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_chic_1 &lt;chr&gt;, bld_cobu_1 &lt;chr&gt;, bld_crng_1 &lt;chr&gt;, bld_cymv_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_denv_1 &lt;chr&gt;, bld_ecsh_1 &lt;chr&gt;, bld_enfc_1 &lt;chr&gt;, bld_enfm_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_entv_4 &lt;chr&gt;, bld_gast_2 &lt;chr&gt;, bld_gbst_1 &lt;chr&gt;, bld_hepe_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_hflu_1 &lt;chr&gt;, bld_hiat_1 &lt;chr&gt;, bld_hitb_2 &lt;chr&gt;, bld_hpev_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_hsv1_1 &lt;chr&gt;, bld_hsv2_1 &lt;chr&gt;, bld_jenv_1 &lt;chr&gt;, bld_klpn_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_lass_1 &lt;chr&gt;, bld_lava_1 &lt;chr&gt;, bld_lavb_1 &lt;chr&gt;, bld_lavp_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_lept_1 &lt;chr&gt;, bld_limo_1 &lt;chr&gt;, bld_mevs_1 &lt;chr&gt;, bld_moca_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_mump_1 &lt;chr&gt;, bld_mytb_1 &lt;chr&gt;, bld_nego_1 &lt;chr&gt;, bld_nipv_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_nmen_1 &lt;chr&gt;, bld_orts_1 &lt;chr&gt;, bld_parv_1 &lt;chr&gt;, bld_plfa_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_plvi_1 &lt;chr&gt;, bld_psae_1 &lt;chr&gt;, bld_rick_1 &lt;chr&gt;, bld_rivf_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_rubv_2 &lt;chr&gt;, bld_salm_1 &lt;chr&gt;, bld_sals_1 &lt;chr&gt;, bld_sapa_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_saty_1 &lt;chr&gt;, bld_stau_2 &lt;chr&gt;, bld_stpn_2 &lt;chr&gt;, bld_stsu_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_toxo_1 &lt;chr&gt;, bld_trpa_1 &lt;chr&gt;, bld_urup_1 &lt;chr&gt;, bld_vazv_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_wenv_1 &lt;chr&gt;, bld_yefv_1 &lt;chr&gt;, bld_yers_1 &lt;chr&gt;, bld_zika_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_abau_1 &lt;chr&gt;, bld_sp_adev_1 &lt;chr&gt;, bld_sp_bart_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_bruc_1 &lt;chr&gt;, bld_sp_bups_1 &lt;chr&gt;, bld_sp_caal_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_cchf_1 &lt;chr&gt;, bld_sp_chic_1 &lt;chr&gt;, bld_sp_cobu_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_crng_1 &lt;chr&gt;, bld_sp_cymv_1 &lt;chr&gt;, bld_sp_denv_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_ecsh_1 &lt;chr&gt;, bld_sp_enfc_1 &lt;chr&gt;, bld_sp_enfm_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_entv_4 &lt;chr&gt;, bld_sp_gast_2 &lt;chr&gt;, bld_sp_gbst_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_hepe_1 &lt;chr&gt;, bld_sp_hflu_1 &lt;chr&gt;, bld_sp_hiat_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_hitb_2 &lt;chr&gt;, bld_sp_hpev_1 &lt;chr&gt;, bld_sp_hsv1_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_hsv2_1 &lt;chr&gt;, bld_sp_jenv_1 &lt;chr&gt;, bld_sp_klpn_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_lass_1 &lt;chr&gt;, bld_sp_lava_1 &lt;chr&gt;, bld_sp_lavb_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_lavp_1 &lt;chr&gt;, bld_sp_lept_1 &lt;chr&gt;, bld_sp_limo_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_mevs_1 &lt;chr&gt;, bld_sp_moca_1 &lt;chr&gt;, bld_sp_mump_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_mytb_1 &lt;chr&gt;, bld_sp_nego_1 &lt;chr&gt;, bld_sp_nipv_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_nmen_1 &lt;chr&gt;, bld_sp_orts_1 &lt;chr&gt;, bld_sp_parv_1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bld_sp_plfa_1 &lt;chr&gt;, …</span>
</pre></div>
<p>While the <code>tac_long</code> table looks like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">d</span><span class="op">$</span><span class="kw">tac_long</span>
<span class="co">#&gt; # A tibble: 477,252 x 6</span>
<span class="co">#&gt;    champs_deid          name    result specimen_type target pathogen            </span>
<span class="co">#&gt;    &lt;chr&gt;                &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;               </span>
<span class="co">#&gt;  1 AB032461-9D11-4391-… bld_ab… Negat… Whole blood   ABAU_1 Acinetobacter bauma…</span>
<span class="co">#&gt;  2 AB032461-9D11-4391-… bld_ad… Negat… Whole blood   ADEV_1 Adenovirus          </span>
<span class="co">#&gt;  3 AB032461-9D11-4391-… bld_ba… Negat… Whole blood   BART_1 Bartonella spp.     </span>
<span class="co">#&gt;  4 AB032461-9D11-4391-… bld_br… Negat… Whole blood   BRUC_1 Brucellaspp.        </span>
<span class="co">#&gt;  5 AB032461-9D11-4391-… bld_bu… Negat… Whole blood   BUPS_1 Burkholderia pseudo…</span>
<span class="co">#&gt;  6 AB032461-9D11-4391-… bld_ca… Negat… Whole blood   CAAL_1 Candida albicans    </span>
<span class="co">#&gt;  7 AB032461-9D11-4391-… bld_cc… Negat… Whole blood   CCHF_1 Crimean-Congo Hemor…</span>
<span class="co">#&gt;  8 AB032461-9D11-4391-… bld_ch… Negat… Whole blood   CHIC_1 Chikungunya virus   </span>
<span class="co">#&gt;  9 AB032461-9D11-4391-… bld_co… Negat… Whole blood   COBU_1 Coxiella burnettii  </span>
<span class="co">#&gt; 10 AB032461-9D11-4391-… bld_cr… Negat… Whole blood   CRNG_1 Cryptococcus neofor…</span>
<span class="co">#&gt; # … with 477,242 more rows</span>
</pre></div>
<p>To count the cases that have a positive the Group B Streptococcus TAC result using the <code>tac</code> table, we would have to find all the column names that correspond with Group B Streptococcus and look for at least one positive result for each case (across all of the specimen types). This can get tedious and is not elegant to code.</p>
<p>As an alternative, we can use the <code>tac_long</code> table much more conveniently. To find cases with a positive result for Group B Streptococcus, we search for a match in the <code>pathogen</code> variable and then filter down to only positive results. There can be more than one positive result for any given case (because there are multiple specimen types), so we want to make sure we only count unique cases.</p>
<p>Below, we use dplyr’s <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function to filter down to positive Group B Streptococcus results, and then use dplyr’s <code><a href="https://dplyr.tidyverse.org/reference/pull.html">pull()</a></code> function to select all of the case identifiers (<code>champd_deid</code>) and store the unique values in a result named <code>id</code>. Note that we are using the pipe operator <code><a href="../reference/%&gt;%.html">%&gt;%</a></code> to send the result of each line of code into the next.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">ids_tac</span> <span class="op">&lt;-</span> <span class="kw">d</span><span class="op">$</span><span class="kw">tac_long</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">pathogen</span> <span class="op">==</span> <span class="st">"Group B Streptococcus"</span> <span class="op">&amp;</span> <span class="kw">result</span> <span class="op">==</span> <span class="st">"Positive"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(<span class="kw">champs_deid</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>()

<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">ids_tac</span>)
<span class="co">#&gt; [1] 207</span>
</pre></div>
<p>We see that there are 207 unique cases that have a positive result for Group B Streptococcus, or <em>died with</em> this pathogen.</p>
<p>Now let’s do a similar operation with the DeCoDe results. Similar to TAC, we will use the long format, <code>dcd_long</code> to find cases.</p>
<p>Recall that <code>dcd_long</code> looks like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">d</span><span class="op">$</span><span class="kw">dcd_long</span>
<span class="co">#&gt; # A tibble: 44,280 x 5</span>
<span class="co">#&gt;    champs_deid          champs_group_desc      type     etiol          etiol_num</span>
<span class="co">#&gt;    &lt;chr&gt;                &lt;chr&gt;                  &lt;chr&gt;    &lt;chr&gt;              &lt;int&gt;</span>
<span class="co">#&gt;  1 B6F81D28-CE23-4034-… Maternal HIV           immedia… Human Immunod…         1</span>
<span class="co">#&gt;  2 B6F81D28-CE23-4034-… Maternal HIV           immedia… &lt;NA&gt;                   2</span>
<span class="co">#&gt;  3 B6F81D28-CE23-4034-… Maternal HIV           immedia… &lt;NA&gt;                   3</span>
<span class="co">#&gt;  4 56550401-228F-457C-… Neonatal preterm birt… immedia… &lt;NA&gt;                   1</span>
<span class="co">#&gt;  5 56550401-228F-457C-… Neonatal preterm birt… immedia… &lt;NA&gt;                   2</span>
<span class="co">#&gt;  6 56550401-228F-457C-… Neonatal preterm birt… immedia… &lt;NA&gt;                   3</span>
<span class="co">#&gt;  7 BA74FEEB-7680-4ABA-… Perinatal asphyxia/hy… immedia… &lt;NA&gt;                   1</span>
<span class="co">#&gt;  8 BA74FEEB-7680-4ABA-… Perinatal asphyxia/hy… immedia… &lt;NA&gt;                   2</span>
<span class="co">#&gt;  9 BA74FEEB-7680-4ABA-… Perinatal asphyxia/hy… immedia… &lt;NA&gt;                   3</span>
<span class="co">#&gt; 10 F773A228-9212-4670-… Neonatal preterm birt… immedia… &lt;NA&gt;                   1</span>
<span class="co">#&gt; # … with 44,270 more rows</span>
</pre></div>
<p>To find cases where Group B Streptococcus is in the causal chain, we want to search in either the <code>champs_group_desc</code> variable or the <code>etiol</code> variable for the condition of interest. In our case, we know that the condition of interest, “Streptococcus agalactiae” is found in the <code>etiol</code> variable so we search there.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">ids_dcd</span> <span class="op">&lt;-</span> <span class="kw">d</span><span class="op">$</span><span class="kw">dcd_long</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">etiol</span> <span class="op">==</span> <span class="st">"Streptococcus agalactiae"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(<span class="kw">champs_deid</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>()

<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">ids_dcd</span>)
<span class="co">#&gt; [1] 45</span>
</pre></div>
<p>We see that there are 45 unique cases that have Group B Streptococcus in the causal chain, or <em>died from</em> this condition.</p>
<p>Now, we want to tabulate these cases by site and age, which means that we need to find the matching IDs for each in the demographics table. Suppose we only want to look at cases in Kenya, Mozambique, and Ethiopia. To do this for DeCoDe:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Kenya"</span>, <span class="st">"Mozambique"</span>, <span class="st">"Ethiopia"</span>)

<span class="kw">dcd_dmg</span> <span class="op">&lt;-</span> <span class="kw">d</span><span class="op">$</span><span class="kw">dmg</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">champs_deid</span> <span class="op">%in%</span> <span class="kw">ids_dcd</span> <span class="op">&amp;</span> <span class="kw">site</span> <span class="op">%in%</span> <span class="kw">sites</span>)
</pre></div>
<p>Now, since the demographics table contains one row per case, we can tabulate the cases by age group and site using <code><a href="https://rdrr.io/r/stats/xtabs.html">xtabs()</a></code>. Note that there are many ways this could be done (e.g. using <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/count.html">tally()</a></code>), but <code><a href="https://rdrr.io/r/stats/xtabs.html">xtabs()</a></code> provides a nice output for displaying in this example.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="op">~</span> <span class="kw">age_group</span> <span class="op">+</span> <span class="kw">site</span>, data = <span class="kw">dcd_dmg</span>, drop.unused.levels = <span class="fl">TRUE</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/addmargins.html">addmargins</a></span>()
<span class="co">#&gt;                              site</span>
<span class="co">#&gt; age_group                     Kenya Mozambique Ethiopia Sum</span>
<span class="co">#&gt;   Stillbirth                      1          1        0   2</span>
<span class="co">#&gt;   Death in the first 24 hours     1          3        0   4</span>
<span class="co">#&gt;   Early Neonate (1 to 6 days)     0          1        1   2</span>
<span class="co">#&gt;   Late Neonate (7 to 27 days)     1          0        0   1</span>
<span class="co">#&gt;   Sum                             3          5        1   9</span>
</pre></div>
<p>We can do the same for TAC:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">tac_dmg</span> <span class="op">&lt;-</span> <span class="kw">d</span><span class="op">$</span><span class="kw">dmg</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">champs_deid</span> <span class="op">%in%</span> <span class="kw">ids_tac</span> <span class="op">&amp;</span> <span class="kw">site</span> <span class="op">%in%</span> <span class="kw">sites</span>)

<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span>(<span class="op">~</span> <span class="kw">age_group</span> <span class="op">+</span> <span class="kw">site</span>, data = <span class="kw">tac_dmg</span>, drop.unused.levels = <span class="fl">TRUE</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/addmargins.html">addmargins</a></span>()
<span class="co">#&gt;                                           site</span>
<span class="co">#&gt; age_group                                  Kenya Mozambique Ethiopia Sum</span>
<span class="co">#&gt;   Stillbirth                                   8          1        0   9</span>
<span class="co">#&gt;   Death in the first 24 hours                  4          6        1  11</span>
<span class="co">#&gt;   Early Neonate (1 to 6 days)                  3          1        1   5</span>
<span class="co">#&gt;   Late Neonate (7 to 27 days)                  3          2        0   5</span>
<span class="co">#&gt;   Infant (28 days to less than 12 months)     10          2        1  13</span>
<span class="co">#&gt;   Child (12 months to less than 60 Months)    11          5        0  16</span>
<span class="co">#&gt;   Sum                                         39         17        3  59</span>
</pre></div>
<!--
tac_tab <- d$dmg %>%
  filter(champs_deid %in% ids_tac) %>%
  group_by(site, age_group) %>%
  tally()
-->
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ryan Hafen, J Hathaway.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
